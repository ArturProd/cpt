{% include 'CptEventBundle:Event:edit.js.twig' with {'event': event, 'eventform':eventform} %}
{% include 'CptEventBundle:Event:edit_googleapi.js.twig' with {'event': event, 'eventform':eventform} %}


<div class="cpt_page">        

    <h1>{{event.id==-1 ? 'event.popup.create_title'|trans: 'event.popup.edit_title'|trans }}</h1>
        <a id="close_edit_event" class="popup_close_button" onclick='DisplayEventEditPanel(false);'>X</a>


        {{ form_start(eventform, {'action': path('event_manage',  { 'id': event.id }), 'method': 'POST' }) }}
        {{ form_widget(eventform.restricted) }}
        {{ form_widget(eventform.approved) }}
        {{ form_widget(eventform.location_long) }}
        {{ form_widget(eventform.location_lat) }}
        <input id="copy_field" name="copy_field" type="hidden" value="0"/>
        <button id="save_button" type="submit">{{'form.save'|trans}}</button>
        {% if event.id != -1 %}
        <button id="copy_button" type="submit">{{'form.event.copy'|trans}}</button>
        {% endif %}
        <input type="hidden" value="{{ event.queue|join(',') }}" id="event_queue_json" name="event_queue_json" /> {# populated with the array of event.queu #}
        <input type="hidden" id="registration_list_json" name="registration_list_json" /> {# will hold the json value of the list_participant array before submitting the form  #}

    <h2>{{'event.tab.description'|trans}}</h2>
        <div class="input_div">
            {{ form_label(eventform.title, null, { 'attr': {'class': 'mandatory_field_label'} }) }}
            {{ form_errors(eventform.title) }}
            {{ form_widget(eventform.title) }}
        </div>
        <div>
            {{ form_errors(eventform.content) }}
            {{ form_widget(eventform.content) }}
        </div>
        <div>
           {{ form_label(eventform.enabled) }}
           {{ form_errors(eventform.enabled) }}
           {{ form_widget(eventform.enabled) }}
        </div>
        <div>
           {{ form_errors(eventform.cpt_event) }}
           {{ form_widget(eventform.cpt_event, {'attr': {'class':'cpt_event_checkbox'} }) }}
           {{ form_label(eventform.cpt_event) }}

        </div>
     <h2>{{'event.where'|trans}}</h2>
    <div class="input_div">
            {{ form_label(eventform.corporate_name, null, { 'attr': {'class': 'input_label mandatory_field_label'} }) }}
            {{ form_errors(eventform.corporate_name) }}
            {{ form_widget(eventform.corporate_name, {'attr':{'placeholder':'event.corporatename.placeholder'|trans} }) }}
     </div>
     <div class="input_div">
        <label class="input_label" for="placesearch">{{'event.googleplacelabel'|trans}}</label>
        <input type="text" id="placesearch" name="placesearch" onFocus="geolocate();" value="" autocomplete="off" >
     </div>
     <div class="error" id="placesearch_error"></div>
     <div class="row-fluid" style="display:none;">
         <div class="span6">

     
            <div  class="input_div">
            {#{ form_label(eventform.city_name, null, { 'attr': {'class': 'input_label mandatory_field_label'} }) }#}
            {{ form_errors(eventform.city_name) }}
            {{ form_widget(eventform.city_name, { 'id' : 'city_name'} ) }}
            </div>

            <div  class="input_div">
            {#{ form_label(eventform.city_postal_code, null, { 'attr': {'class': 'input_label'} }) }#}
            {{ form_errors(eventform.city_postal_code) }}
            {{ form_widget(eventform.city_postal_code, { 'id':'city_postal_code'} ) }}
            </div>
                
            <div  class="input_div">
            {#{ form_label(eventform.address, null, { 'attr': {'class': 'input_label'} }) }#}
            {{ form_errors(eventform.address) }}
            {{ form_widget(eventform.address, {'id':'address'} ) }}
            </div>
             
            <div  class="input_div">
            {#{ form_label(eventform.address_num, null, { 'attr': {'class': 'input_label'} }) }#}
            {{ form_errors(eventform.address_num) }}
            {{ form_widget(eventform.address_num,  { 'id':'address_num'} ) }}
            </div>
             
            <div  class="input_div">
            {#{ form_label(eventform.country_name, null, { 'attr': {'class': 'input_label'} }) }#}
            {{ form_errors(eventform.country_name) }}
            {{ form_widget(eventform.country_name, {  'id':'country_name'} ) }}
            </div>
             
            <div  class="input_div">
            {#{ form_label(eventform.country_code, null, { 'attr': {'class': 'input_label'} }) }#}
            {{ form_errors(eventform.country_code) }}
            {{ form_widget(eventform.country_code, { 'id':'country_code'}) }}
            </div>
         </div>
       <div class="span6"> 
        {# <div id="map_canvas" style="width:200px;height:200px;"></div> #}
       </div>>
     </div>
            {# location #}
     <h2>{{'event.when'|trans}}</h2>
      <div class="row-fluid">
         <div class="span6">
          {{ form_label(eventform.begin) }}
          {{ form_errors(eventform.begin) }}
          {{ form_widget(eventform.begin, { 'attr':{ 'class': 'cpt_datetime' }}) }}               
         </div>
          <div class="span6">
            {{ form_label(eventform.end) }}
            {{ form_errors(eventform.end) }}
            {{ form_widget(eventform.end, { 'attr':{ 'class': 'cpt_datetime' }}) }}               
          </div>
      </div>
     <div class="row-fluid">
         <div class="span12 event_timespan" id="event_timespan"></div>
     </div>
      <h2>{{'event.attendees'|trans}}</h2>
        <div class="row-fluid">
            <div class="span6">
                <div class="input_div">
                    {{ form_label(eventform.maxnumattendees, null, { 'attr': {'class': 'input_label mandatory_field_label'} }) }}
                    {{ form_widget(eventform.maxnumattendees, { 'id': 'maxnumattendees', 'attr':{ 'class': 'cpt_integerselect' } }) }}
                    {{ form_errors(eventform.maxnumattendees) }}
                </div>
            </div>
            <div class="span6">
               {{ form_label(eventform.registration_allowed, null, { 'attr': {'class': 'input_label mandatory_field_label'} }) }}
               {{ form_errors(eventform.registration_allowed) }}
               {{ form_widget(eventform.registration_allowed) }}    
                {% if event.id !=-1 %}
                      <a href="{{ url('event_download_attendees', { 'eventid': event.id })  }}">{{'event.download_atendees_list'|trans}}</a>
                {% endif %}
            </div>
        </div>
            {# Participants #}

            {# ************************************************************************************************************************ #} 
            {# user search field #}
            <div class="row-fluid">
                <div class="span12">
                    <div class="input_div">
                    <label class="input_label mandatory_field_label required" for="user_search">{{'event.user.search'|trans}}</label>
                    <div class="ui-widget">
                        <input id="user_search" type="text" class="input_text" />
                    </div>
                    </div>
                </div>
            </div>
            {# registration table #}
            <table class='cpt_table' style='width:700px;' id='reservation_table'>
                <tr>
                    <th>Nom</th>
                    <th>Nombre de places demandées</th>
                    <th>Nombre de places demandées en attente</th>
                    <th>Animateur</th>
                    <th>Actions</th>
                </tr>
            </table>

            <button onclick="$('#queue_table').toggle();return false;">{{'event.show_hide_attendeelist'|trans}}</button>

            {# queue table #}
            <table class='cpt_table' style='width:700px;' id="queue_table">
                <thead>
                <tr>
                    <th>{{'event.attendeequeue.rank'|trans}}</th>
                    <th>{{'event.attendeequeue.name'|trans}}</th>
                    <th>{{'event.attendeequeue.requested_seats'|trans}}</th>
                    <th>{{'event.attendeequeue.queued'|trans}}</th>
                </tr>
                </thead>
                <tbody id="queue_table_body">
                </tbody>
            </table>
    {{ form_end(eventform) }}
</div>


        
 
  
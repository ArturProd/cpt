<script type="text/javascript">
{# handles the submition of a new comment #}
function handle_comment_submit(postId)
{
        
    dataString = $('#form_comment_'+postId).serialize();

    $('#submit_comment_' + postId).attr("disabled", "disabled");

    $.ajax({
        type: "POST",
        url: '{{ url('sonata_news_add_comment') }}',
        data: dataString,
        cache: false,
        success: function(html){
            $("ul#comment_list_"+postId).prepend(html);
            $('#submit_comment_' + postId).removeAttr("disabled");
            $('#comment_list_'+postId).show('blind');
            $("ul#comment_list_"+postId+" li:first").fadeIn();
        },
        error: function(jqXHR, exception) {
            {# 401 error would happen if session has expired (access not authorized) #}
            if (jqXHR.status === 401) {
                document.location='{{ url('cpt_blog_home')}}';
            } else
            {
                alert("Une erreur est survenue lors de l'envoi de votre commentaire.");
            }
            $('#submit_comment_' + postId).removeAttr("disabled");
        }
    });
    
    
 }

{# handles the deletion of a comment #}
function delete_comment(commentid)
{
    dataString = 'id='+commentid;

    $('#comment_delete_button_'+commentid).attr("disabled", "disabled");

    $.ajax({
        type: "POST",
        url: '{{ url('sonata_news_delete_comment') }}',
        data: dataString,
        cache: false,
        success: function(html){
            $('#comment_'+commentid).html('');
            $('#comment_'+commentid).slideUp();
        },
        error : function(resultat, statut, erreur){
          alert("Une erreur est survenue lors de la suppression de votre commentaire");
        }
    });
}

function toggle_submit_comment_button(textvalue, postid)
{
    if (textvalue)
       $("#submit_comment_"+postid).removeAttr("disabled"); 
    else
       $("#submit_comment_"+postid).attr("disabled", "disabled"); 
}
</script>